# Guía general para documentar el desarrollo de este proyecto

## 1) Activar el ambiente virtual
Antes de ejecutar cualquier script, activa el ambiente virtual:

```bash
act bb
```

> Si el comando no existe en tu shell, asegúrate de tener el alias/función configurado, o activa el entorno con:
> ```bash
> source /home/gomosak/ambientes/bb/bin/activate
> ```

---

## 2) Dividir el dataset (train / valid / test)
Para dividir el dataset en **train**, **valid** y **test** con porcentajes personalizados, ejecuta:

```bash
python segmentation_dataset.py \
  --images-dir /path/to/images \
  --labels-dir /path/to/labels \
  --output-base output/path \
  --train 0.7 --valid 0.2 --test 0.1 \
  --frame-class 1 --target-class 0 \
  --seed 42 --log-level INFO

```

```bash
python segmentation_dataset.py \                                     
  --images-dir /home/gomosak/abejas/abejas/images \
  --labels-dir /home/gomosak/abejas/abejas/labels \
  --output-base /home/gomosak/abejas/abejas_segmentation \
  --train 0.7 --valid 0.2 --test 0.1 \
  --frame-class 1 --target-class 0 \
  --seed 42 --log-level INFO

```




Este script:
- Lee imágenes desde `abejas/images/` y labels desde `abejas/labels/`.
- Recorta cada imagen según el **marco (clase 1)**, y mantiene/clippea los **polígonos (clase 0)** dentro del recorte.
- Divide aleatoriamente el conjunto en las proporciones configuradas.
- Genera la estructura:

```
abejas_segmentation/
 ├── train/
 │   ├── images/
 │   └── labels/
 ├── valid/
 │   ├── images/
 │   └── labels/
 └── test/
     ├── images/
     └── labels/
```

> Asegúrate de que cada imagen tenga su archivo de etiqueta con el **mismo nombre base** (`imagen.jpg` → `imagen.txt`) en formato **YOLO-seg**:  
> `clase x1 y1 x2 y2 ...` (coordenadas **normalizadas** en `[0,1]`).

---

## 3) Calcular el área de los polígonos
Para obtener el área de los polígonos anotados en las imágenes:

```bash
python area.py
```

Este script:
- Convierte coordenadas normalizadas a píxeles.
- Calcula el área de cada polígono (p. ej., usando la fórmula de Shoelace).
- Reporta o guarda resultados según su configuración (consola/archivo).

---

## 4) Visualizar y verificar recortes y polígonos
Para comprobar que:
- El recorte al **marco (clase 1)** es correcto.
- Los polígonos **clase 0** se mantienen y/o se reescalan adecuadamente.

Ejecuta:

```bash
python verification_polygons.py
```

Características típicas:
- Muestra la imagen original con anotaciones y, en paralelo, el recorte con polígonos reproyectados.
- Interacción por teclado: **tecla cualquiera** avanza, **ESC** sale.
- Requiere entorno con **GUI** para `cv2.imshow`. En servidores/headless, usa un modo que guarde imágenes de verificación a disco.

---

## Notas y buenas prácticas

- **Estructura de entrada esperada:**
  ```
  abejas/
   ├── images/
   └── labels/
  ```
- **Dependencias:** instala dentro del entorno virtual:
  ```bash
  pip install -r requirements.txt
  ```
  (suele incluir `opencv-python`, `numpy`, etc.)

- **Porcentajes de split:** ajusta en `segmentation_dataset.py` (por ejemplo, `train=0.7`, `valid=0.2`, `test=0.1`).
- **Validación de labels:** verifica que todas las coordenadas estén en `[0,1]`. Labels corruptos pueden provocar recortes vacíos o polígonos fuera de rango.
- **Nombres y extensiones:** el script puede filtrar por `('.jpg', '.jpeg', '.png')`. Ajusta según necesites.
- **Reproducibilidad:** fija una semilla de aleatoriedad (`random.seed(...)`) si quieres splits consistentes entre corridas.

---

## Solución de problemas

- **Veo imágenes negras en la visualización:**
  - Abre la imagen en un visor externo para confirmar que el recorte no haya producido una imagen vacía.
  - Imprime min/max de pixeles tras la lectura (`img.min(), img.max()`).
  - Revisa que el **marco (clase 1)** sea válido y esté bien anotado.
- **No puedo redimensionar la ventana de OpenCV:**
  - Usa `cv2.namedWindow("Visualización", cv2.WINDOW_NORMAL)` y `cv2.resizeWindow("Visualización", ancho, alto)`.
- **Faltan labels:**
  - Los scripts suelen omitir imágenes sin su `*.txt` correspondiente, o generar un label vacío; ajusta la política según tus necesidades.

---

## Comandos rápidos

```bash
# Activar entorno
act bb

# Dividir dataset
python segmentation_dataset.py

# Calcular áreas
python area.py

# Verificar visualmente recortes/polígonos
python verification_polygons.py
```
